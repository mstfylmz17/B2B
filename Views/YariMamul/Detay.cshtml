@using VNNB2B.Models.Hata
@model EntityLayer.Dto.DtoYariMamul
@{
    ViewData["Title"] = "Detay";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@{
    string mesaj = ViewBag.hata;
    var hasError = !string.IsNullOrEmpty(ViewBag.hata);
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    @if (hasError)
    {
        <script>
            $(document).ready(function () {
                Swal.fire({
                    icon: 'info',
                    title: '@mesaj'
                });
            });
        </script>
    }
    YariMamulHata.Icerik = "";
}

<nav class="breadcrumb-one" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/Admin"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-home"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg></a></li>
        <li class="breadcrumb-item"><a href="/YariMamul">Yarı Mamuller</a></li>
        <li class="breadcrumb-item"><a href="#">Yarı Mamul Detay</a></li>
    </ol>
</nav>
<div class="row">
    <div class="col-12">
        <div id="flStackForm" class="col-lg-12 layout-spacing layout-top-spacing">
            <div class="statbox widget box box-shadow">
                <div class="widget-header">
                    <div class="row">
                        <div class="col-xl-12 col-md-12 col-sm-12 col-12">
                            <h4>Yarı Mamul Bilgileri</h4>
                        </div>
                    </div>
                </div>
                <div class="widget-content widget-content-area">
                    <form id="YariMamulForm">
                        <div class="form-group mb-3">
                            <input type="text" class="form-control" id="Kodu" aria-describedby="emailHelp1" placeholder="Yarı Mamul Kodu : @Model.Kodu">
                        </div>
                        <div class="form-group mb-3">
                            <input type="text" class="form-control" id="Aciklama" aria-describedby="emailHelp1" placeholder="Yarı Mamul Açıklama : @Model.Aciklama">
                        </div>
                        <div class="form-group mb-3">
                            <input type="number" class="form-control" id="KritikStokMiktari" aria-describedby="emailHelp1" placeholder="Kritik Stok Miktarı : @Model.KritikStokMiktari">
                        </div>
                        <div class="form-group mb-3">
                            <input type="number" class="form-control" id="Stok" aria-describedby="emailHelp1" placeholder="Güncel Stok Miktarı : @Model.Stok">
                        </div>
                        <div class="form-group mb-3">
                            @Html.DropDownList("BirimID", (List<SelectListItem>)ViewBag.birimler, "Birim : " + @Model.BirimID, new { @class = "form-control basic", id = "BirimID" })
                        </div>
                        <div class="form-group mb-3">
                            @Html.DropDownList("YariMamulGrupID", (List<SelectListItem>)ViewBag.birimler, "Yarı Mamul Grubu : " + @Model.YariMamulGrupID, new { @class = "form-control basic", id = "YariMamulGrupID" })
                        </div>
                        <div class="form-group mb-3">
                            <label><img src="@Model.Resim" class="img-thumbnail" style="width: 100px;" /></label>
                            <input type="file" class="form-control-file" id="exampleInputFile" name="imagee">
                        </div>
                        <button type="button" onclick="AddForm()" class="btn btn-primary mt-3">Güncelle</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<link href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.5.1.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://code.jquery.com/jquery-3.7.0.js"></script>

<script>
    function AddForm() {
        var form = $('#YariMamulForm')[0];
        var formData = new FormData(form);
        formData.append("ID", $("#ID").val());
        formData.append("Kodu", $("#Kodu").val());
        formData.append("imagee", $("#imagee").val());
        formData.append("Aciklama", $("#Aciklama").val());
        formData.append("BirimID", $("#BirimID").val());
        formData.append("KritikStokMiktari", $("#KritikStokMiktari").val());
        formData.append("YariMamulGrupID", $("#YariMamulGrupID").val());
        $.ajax({
            type: "POST",
            url: "/YariMamulApi/YariMamulDuzenle",
            data: formData,
            contentType: false,
            processData: false,
            dataType: "json",
            success: function (result) {
                swal.fire({
                    title: result.status === "success" ? 'Başarılı!' : 'Başarısız!',
                    text: result.message,
                    type: result.status === "success" ? 'success' : 'warning',
                    confirmButtonText: 'Tamam'
                });
                $("#Kodu").val('');
                $("#Aciklama").val('');
                $("#imagee").val('');
                $("#BirimID").val('');
                $("#KritikStokMiktari").val('');
                $("#YariMamulGrupID").val('');
                tabloGuncelle();
            }
        });
    }
</script>
